#scraping.container
  .page-header
    h1
      | Media scraping
      small< ng-if='mediaUrlsList.pagination.total >= 1 || mediaUrlsList.pagination.filtered'
        | {{ mediaUrlsList.pagination.total | number }}
        span ng-if='!mediaUrlsList.pagination.filtered'
          span< total
        span ng-if='mediaUrlsList.pagination.filtered'
          span< matching
        span ng-if='scrapingErrorsCount'
          span>
            | ,
          strong.text-danger ng-if='scrapingErrorsCount == 1' 1 error
          strong.text-danger ng-if='scrapingErrorsCount >= 2' {{ scrapingErrorsCount | number }} errors
        strong.text-warning ng-if='scrapingCanceledCount'
          | , {{ scrapingCanceledCount | number }} canceled
        span.text-primary ng-if='scrapingInProgressCount'
          | , {{ scrapingInProgressCount | number }} in progress
  div st-pipe='mediaUrlsList.refresh' st-table='mediaUrlsList.records'
    table-filters filters='mediaUrlsList.params'
      form.filters
        .btn-group
          button.btn.btn-danger ng-model='filters.show' btn-radio='"errors"' uncheckable=true
            span.glyphicon.glyphicon-thumbs-down>
            | Show errors
          button.btn.btn-warning ng-model='filters.show' btn-radio='"canceled"' uncheckable=true
            span.glyphicon.glyphicon-warning-sign>
            | Show canceled
          button.btn.btn-primary ng-model='filters.show' btn-radio='"inProgress"' uncheckable=true
            span.glyphicon.glyphicon-time>
            | Show in progress
    table#events.table.table-striped.table-hover
      thead
        tr
          th.provider Provider
          th.url Media
          th.work Work
          th.status Status
      tbody
        tr.loading ng-if='!mediaUrlsList.initialized'
          td colspan=4 Loading...
        tr.empty ng-if='mediaUrlsList.initialized && !mediaUrlsList.records.length'
          td colspan=4
            span ng-if='mediaUrlsList.pagination.filtered' No matching media found.
            span ng-if='!mediaUrlsList.pagination.filtered' No media scraped.
        tr ng-repeat='url in mediaUrlsList.records'
          td
            a href='http://anidb.net'
              .label.label-default ng-if='url.provider == "anidb"' AniDB
            a href='http://www.imdb.com'
              .label.label-default ng-if='url.provider == "imdb"' IMDB
          td
            a href='{{ url.url }}' {{ url.url }}
          td
            span ng-if='!url.work'
              | -
            span ng-if='url.work'
              | {{ url.work.titles[0].text }}
          td
            a href='#' ng-click='showSupportedScrapers()'
              .label.label-default ng-if='!url.scrap' Scraping not yet supported

            .label.label-primary ng-if='url.scrap.state == "created"' Queued

            .label.label-primary ng-if='url.scrap.state == "scraping" || url.scrap.state == "scraped"' Scraping

            .label.label-warning ng-if='url.scrap.state == "scrapingCanceled"' Canceled

            .label.label-danger ng-if='url.scrap.state == "scrapingFailed" && !currentUserIs("admin")' tooltip='URL could not be scraped' Scraping error
            a href='#' ng-if='url.scrap.state == "scrapingFailed" && currentUserIs("admin")' ng-click='showScrapingError(url.scrap)' tooltip='URL could not be scraped'
              .label.label-danger Scraping error

            .label.label-danger ng-if='url.scrap.state == "expansionFailed" && !currentUserIs("admin")' tooltip='Scraped data could not be parsed' Scraping error
            a href='#' ng-if='url.scrap.state == "expansionFailed" && currentUserIs("admin")' ng-click='showScrapingError(url.scrap)' tooltip='Scraped data could not be parsed'
              .label.label-danger Scraping error

            .label.label-success ng-if='url.scrap.state == "expanded"' Scraped
      tfoot
        tr
          td.text-center st-pagination=true st-items-by-page=15 st-template='/templates/modules/tables/tables.pagination.template.html' colspan=4
